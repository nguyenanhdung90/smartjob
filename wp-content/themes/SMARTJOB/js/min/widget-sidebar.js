jQuery(document).ready(function(e){JobEngine.Views.Post_Job_Sidebar=Backbone.View.extend({el:e("div#static-text-sidebar"),events:{"click a.add-more":"add_more"},initialize:function(){console.log("post job sidebar initialized");that=this;e(".view").each(function(){var t=e(this).parents(".widget"),n=new JobEngine.Views.JobStaticTextWidget({el:t})})},add_more:function(e){e.preventDefault();this.addOne()},addOne:function(){console.log("addOne");var e=new JobEngine.Views.JobStaticTextWidget;this.$("#sidebar").append(e.render("").el);tinyMCE.execCommand("mceAddControl",false,"static-text")}});JobEngine.Views.JobStaticTextWidget=Backbone.View.extend({tagName:"div",className:"widget widget-contact bg-grey-widget",events:{"dblclick  .view":"editWidget","click a.edit":"editWidget","click a.apply":"saveWidget","click a.cancel":"cancelWidget","click a.remove":"removeWidget"},sidebar:"user-dashboard-sidebar",text:false,template:_.template('<textarea class="textarea" id="static-text"><%=content %></textarea>'+'<div class="btn-widget">'+'<a href="#" class="bg-btn-action border-radius apply">'+et_globals.txt_ok+"</a>"+'<a href="#" class="bg-btn-action border-radius cancel">'+et_globals.txt_cancel+"</a>"+"</div>"),initialize:function(){this.sidebar=e("#sidebar").attr("class");return this},saveWidget:function(t){t.preventDefault();var n=e(t.currentTarget),r=n.parents(".widget"),i=r.find("textarea").val(),s=this.sidebar,o=r.attr("id");e.ajax({url:et_globals.ajaxURL,type:"post",data:{action:"et-save-job-static-text",html:i,id:o,sidebar:s},beforeSend:function(){n.html('<img src="'+et_globals.imgURL+'/loading.gif" />')},success:function(e){if(e.success){r.html('<div class="view" >'+e.msg+"</div>"+'<div class="btn-widget edit-remove">'+'<a href="#" class="bg-btn-action border-radius edit"><span class="icon" data-icon="p"></span></a>'+'<a href="#" class="bg-btn-action border-radius remove"><span class="icon" data-icon="#"></span></a>'+"</div>");r.attr("id",e.id);r.removeClass("editting")}else{n.html("OK")}}});console.log("apply")},editWidget:function(t){console.log("edit");t.preventDefault();var n=e(t.currentTarget),r=n.parents(".widget");this.render(r.find(".view").html());tinyMCE.execCommand("mceAddControl",false,"static-text");r.addClass("editting")},cancelWidget:function(t){t.preventDefault();var n=e(t.currentTarget),r=n.parents(".widget");r.removeClass("editting");if(this.text){r.html('<div class="view">'+this.text+"</div>"+'<div class="btn-widget edit-remove">'+'<a href="#" class="bg-btn-action border-radius edit"><span class="icon" data-icon="p"></span></a>'+'<a href="#" class="bg-btn-action border-radius remove"><span class="icon" data-icon="#"></span></a>'+"</div>");this.text=false}else{r.remove()}console.log("cancel")},removeWidget:function(t){t.preventDefault();var n=e(t.currentTarget),r=n.parents(".widget"),i=this.sidebar,s=r.attr("id");console.log(i);e.ajax({url:et_globals.ajaxURL,type:"post",data:{action:"et-remove-job-static-text",id:s,sidebar:i},beforeSend:function(){n.html('<img src="'+et_globals.imgURL+'/loading.gif" />')},success:function(e){if(e.success){r.remove()}else{n.html('<span class="icon" data-icon="#"></span>')}}})},render:function(e){this.text=e;this.destroyEditing();this.$el.html(this.template({content:e}));if(this.text===""){this.$el.attr("id",0);this.$el.addClass("editting")}console.log("render");return this},destroyEditing:function(){e(".editting").html('<div class="view">'+e(".editting").find("textarea").val()+"</div>"+'<div class="btn-widget edit-remove">'+'<a href="#" class="bg-btn-action border-radius edit"><span class="icon" data-icon="p"></span></a>'+'<a href="#" class="bg-btn-action border-radius remove"><span class="icon" data-icon="#"></span></a>'+"</div>");tinyMCE.execCommand("mceRemoveControl",false,"static-text");e(".editting").removeClass("editting")}});new JobEngine.Views.Post_Job_Sidebar})