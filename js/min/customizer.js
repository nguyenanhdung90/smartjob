var Customizer=Backbone.View.extend({el:"#customizer",events:{"click #save_customizer":"saveCustomization","change .fontchoose":"changeFont","click .layout-item":"changeLayout","click #reset_customizer":"resetCustomizer","click .scheme-item":"chooseSchemes","click .pattern-item":"choosePattern","click .custom-head h3":"toggleSection"},schemes:[{background:"#ffffff",header:"#4B4B4B",heading:"#4B4B4B",text:"#555555",action:"#E87863",footer:"#E0E0E0","font-heading":"Arial, san-serif","font-heading-size":"22px","font-heading-style":"normal","font-heading-weight":"normal","font-text":"Arial, san-serif","font-text-size":"12px","font-text-style":"normal","font-text-weight":"normal","font-action":"Arial, san-serif","font-action-size":"12px","font-action-style":"normal","font-action-weight":"normal",layout:"content-sidebar",pattern:"0"},{background:"#FAF9F5",header:"#263E57",heading:"#4B4B4B",text:"#555555",action:"#C73E2C",footer:"#F7F0E6","font-heading":"Helvetica, san-serif","font-heading-size":"22px","font-heading-style":"normal","font-heading-weight":"normal","font-text":"Helvetica, san-serif","font-text-size":"12px","font-text-style":"normal","font-text-weight":"normal","font-action":"Helvetica, san-serif","font-action-size":"12px","font-action-style":"normal","font-action-weight":"normal",layout:"content-sidebar",pattern:"0"},{background:"#FFFEFC",header:"#46433A",heading:"#4B4B4B",text:"#555555",action:"#CE534D",footer:"#46433A","font-heading":"Helvetica, san-serif","font-heading-size":"22px","font-heading-style":"normal","font-heading-weight":"normal","font-text":"Helvetica, san-serif","font-text-size":"12px","font-text-style":"normal","font-text-weight":"normal","font-action":"Helvetica, san-serif","font-action-size":"12px","font-action-style":"normal","font-action-weight":"normal",layout:"content-sidebar",pattern:"6"},{background:"#FAFAFA",header:"#626266",heading:"#4B4B4B",text:"#555555",action:"#CE534D",footer:"#020304","font-heading":"Helvetica, san-serif","font-heading-size":"22px","font-heading-style":"normal","font-heading-weight":"normal","font-text":"Helvetica, san-serif","font-text-size":"12px","font-text-style":"normal","font-text-weight":"normal","font-action":"Helvetica, san-serif","font-action-size":"12px","font-action-style":"normal","font-action-weight":"normal",layout:"content-sidebar",pattern:"1"},{background:"#EFF7F4",header:"#224743",heading:"#4B4B4B",text:"#555555",action:"#CE534D",footer:"#020304","font-heading":"Helvetica, san-serif","font-heading-size":"22px","font-heading-style":"normal","font-heading-weight":"normal","font-text":"Helvetica, san-serif","font-text-size":"12px","font-text-style":"normal","font-text-weight":"normal","font-action":"Helvetica, san-serif","font-action-size":"12px","font-action-style":"normal","font-action-weight":"normal",layout:"content-sidebar",pattern:"0"},{background:"#FFFFFF",header:"#9A2620",heading:"#4B4B4B",text:"#555555",action:"#F19131",footer:"#262626","font-heading":"Helvetica, san-serif","font-heading-size":"22px","font-heading-style":"normal","font-heading-weight":"normal","font-text":"Helvetica, san-serif","font-text-size":"12px","font-text-style":"normal","font-text-weight":"normal","font-action":"Helvetica, san-serif","font-action-size":"12px","font-action-style":"normal","font-action-weight":"normal",layout:"content-sidebar",pattern:"0"},{background:"#F2F4F7",header:"#252D3B",heading:"#4B4B4B",text:"#555555",action:"#B5740B",footer:"#20242C","font-heading":"Helvetica, san-serif","font-heading-size":"22px","font-heading-style":"normal","font-heading-weight":"normal","font-text":"Helvetica, san-serif","font-text-size":"12px","font-text-style":"normal","font-text-weight":"normal","font-action":"Helvetica, san-serif","font-action-size":"12px","font-action-style":"normal","font-action-weight":"normal",layout:"content-sidebar",pattern:"5"},{background:"#FFFCFD",header:"#240B19",heading:"#4B4B4B",text:"#555555",action:"#B5740B",footer:"#260919","font-heading":"Helvetica, san-serif","font-heading-size":"22px","font-heading-style":"normal","font-heading-weight":"normal","font-text":"Helvetica, san-serif","font-text-size":"12px","font-text-style":"normal","font-text-weight":"normal","font-action":"Helvetica, san-serif","font-action-size":"12px","font-action-style":"normal","font-action-weight":"normal",layout:"content-sidebar",pattern:"3"}],initialize:function(){var e=this,t=null;$(".picker-trigger").each(function(){var n=$(this);n.ColorPicker({color:n.getHexBackgroundColor(),onBeforeShow:function(){openColorPicker=true},onHide:function(){openColorPicker=false},onChange:function(r,i,s){n.css("background-color","#"+i);if(t!=null)clearTimeout(t);t=setTimeout(function(){e.chooseColor(n.attr("data"),i)},100)},onSubmit:function(e,t,n){}})});$("#customizer .slider").applySlider({change:function(t,n){e.changeFontSize(t,n);e.refreshLess()}});this.$(".select-wrap").click(function(e){$(this).find("select").focus()});this.defaultCustomizer=_.clone(customizer);$("#customizer").hover(this.showPanel,this.hidePanel);$(window).scroll(this.scrollHandle);$("#customizer").css("max-height",$(window).height()-100)},hidePanel:function(e){t=null;var n=$("#customizer").offset().left<0,r=$.contains($("#customizer")[0],e.target),i=$(e.target).attr("id")=="customizer",s=$(e.target).parents(".colorpicker").length>0;openColorPicker=typeof openColorPicker!="undefined"?openColorPicker:false;if(!n&&!openColorPicker){if(t!=null)clearTimeout(t);$("#customizer").css("opacity",".5");t=setTimeout(function(){$("#customizer").animate({left:"-213px"})},1e3)}},showPanel:function(e){var n=$("#customizer").offset().left<0,r=$.contains($("#customizer")[0],e.target),i=$(e.target).attr("id")=="customizer",s=$(e.target).parents(".colorpicker").length>0;$("#customizer").css("opacity","1");if(typeof t!="undefined"&&t!=null){clearTimeout(t)}if(n){$("#customizer").animate({left:"0px"})}},scrollHandle:function(e){var n=128-$("html").offset().top;if(typeof t!="undefined"&&t!=null){clearTimeout(t)}t=setTimeout(function(){$("#customizer").animate({top:n+"px"})},100)},refreshLess:function(){localStorage.clear();less.refresh(true)},resetCustomizer:function(){customizer=_.clone(this.defaultCustomizer);this.refreshCustomizer()},refreshCustomizer:function(){this.$("div.picker-trigger[data=header]").css("background-color",customizer["header"]);this.$("div.picker-trigger[data=heading]").css("background-color",customizer["heading"]);this.$("div.picker-trigger[data=footer]").css("background-color",customizer["footer"]);this.$("div.picker-trigger[data=background]").css("background-color",customizer["background"]);this.$("div.picker-trigger[data=action]").css("background-color",customizer["action"]);this.$("select[name=font-heading]").val(customizer["font-heading"]);this.$("select[name=font-text]").val(customizer["font-text"]);this.$(".heading-size").slider("value",customizer["font-heading-size"].replace(/([0-9]+)[a-zA-Z]+/,"$1"));this.$(".text-size").slider("value",customizer["font-text-size"].replace(/([0-9]+)[a-zA-Z]+/,"$1"));if(customizer["layout"]=="content"){this.$(".no-sidebar").trigger("click")}else if(customizer["layout"]=="content-sidebar"){this.$(".r-sidebar").trigger("click")}else if(customizer["layout"]=="sidebar-content"){this.$(".l-sidebar").trigger("click")}this.refreshLess()},chooseColor:function(e,t){customizer[e]="#"+t;this.refreshLess()},changeFontSize:function(e,t){var n=$(e.target),r=n.find("input[type=hidden]");element=r.attr("name");r.val(t.value+"px");customizer[element]=r.val();if(element=="font-text-size")customizer["font-action-size"]=r.val()},changeFont:function(e){var t=$(e.currentTarget),n=t.attr("name");customizer[n]=t.val();if(n=="font-text")customizer["font-action"]=t.val();this.refreshLess()},changeLayout:function(e){e.preventDefault();var t=$(e.currentTarget),n=t.parent();if(!n.hasClass("current")){$(".block-layout li").removeClass("current");n.addClass("current");customizer["layout"]=t.attr("data");if(t.hasClass("l-sidebar")){$("body").removeClass("one-column").removeClass("right-sidebar").addClass("two-column left-sidebar")}else if(t.hasClass("r-sidebar")){$("body").removeClass("one-column").removeClass("left-sidebar").addClass("two-column right-sidebar")}else{$("body").removeClass("two-column").removeClass("left-sidebar").removeClass("right-sidebar").addClass("one-column")}}},chooseSchemes:function(e){var t=$(e.currentTarget);index=t.index();customizer=_.clone(this.schemes[index]);this.refreshCustomizer()},choosePattern:function(e){customizer["pattern"]=$(e.currentTarget).attr("data");$(".pattern-item").removeClass("current");$(e.currentTarget).addClass("current");this.refreshLess()},toggleSection:function(e){var t=$(e.currentTarget).parents(".section");var n=t.find(".section-content");if(n.is(":not(:hidden)"))return false;this.$(".section-content:not(:hidden)").slideToggle(function(){$("#customizer").pretty_scrollbar()});n.slideToggle()},saveCustomization:function(e){if($(e.currentTarget).hasClass("loading"))return false;var t={url:et_globals.ajaxURL,type:"post",data:{action:"save-customization",content:{customization:customizer}},beforeSend:function(){$(e.currentTarget).addClass("loading")},success:function(t){$(e.currentTarget).removeClass("loading");if(!t.success){alert("Something went wrong! System cause following error \n "+t.msg)}}};$.ajax(t)}});$.fn.pretty_scrollbar=function(e){$(this).each(function(){var e=$(this),t=e.html(),n=$('<div class="scrollbar"><div class="track"><div class="thumb"><div class="end"></div></div></div></div>');viewport=$('<div class="viewport"></div>').append($('<div class="overview"></div>')),height=$(e).outerHeight(true),width=$(e).width();if(!$(this).hasClass("scrollable")){e.find("form").wrapInner($('<div class="overview">')).wrapInner($('<div class="viewport">').css({height:$("#customizer").height(),width:width}));e.prepend($('<div class="scrollbar"><div class="track"><div class="thumb"><div class="end"></div></div></div></div>'));e.addClass("scrollable").tinyscrollbar()}e.tinyscrollbar();if(e.find(".viewport").height()>=e.find(".overview").height())e.addClass("scroll-disable");else e.removeClass("scroll-disable");$(window).resize(function(){$(e).find(".viewport").css("height",$("#customizer").height());$(e).tinyscrollbar()})})};$.fn.applySlider=function(e){var t=e||{};$(this).each(function(){var e=$(this);var n=t||{};n=_.extend({min:parseInt(e.attr("data-min"))||12,max:parseInt(e.attr("data-max"))||14,step:1,range:"min",value:parseInt(e.attr("data-value"))||n.min},n);n.create=function(e,t){var r=$(e.target),s=(n.value-n.min)/(n.max-n.min)*100,o=(n.max-n.min)/n.step;r.append($('<div class="slide-bubble">').css({left:s+"%"}).html(n.value));var u=$('<div class="rulers">');for(i=0;i<=o;i++){s=i/(n.max-n.min)*100;u.append($('<div class="ruler-item">').css({left:s+"%"}))}r.append(u)};n.slide=function(e,t){var r=$(e.target),i=(t.value-n.min)/(n.max-n.min)*100;r.find(".slide-bubble").css({left:i+"%"}).html(t.value)};var r=n.change||function(e,t){};n.change=function(e,t){var i=$(e.target),s=(t.value-n.min)/(n.max-n.min)*100;i.find(".slide-bubble").css({left:s+"%"}).html(t.value);r(e,t)};$(this).slider(n)})};$.fn.getHexBackgroundColor=function(){function n(e){return("0"+parseInt(e,10).toString(16)).slice(-2)}var e=$(this).css("background-color"),t;if(!e){return"#FFFFFF"}t=e.match(/^rgb\((\d+),\s*(\d+),\s*(\d+)\)$/);if(t){return"#"+n(t[1])+n(t[2])+n(t[3])}else{return e}};$(document).ready(function(){var e=new Customizer})